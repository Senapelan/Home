<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senapelan Satu Pintu</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Senapelan Satu Pintu">
    <meta name="apple-mobile-web-app-title" content="Senapelan">
    <meta name="description" content="Pelayanan terbaik lahir dari keikhlasan dan kebersamaan">
    <meta name="theme-color" content="#0066FF">
    <meta name="msapplication-TileColor" content="#0066FF">
    
    <!-- iOS Specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Open Graph utama -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://senapelan.github.io/Home/">
    <meta property="og:title" content="Senapelan Satu Pintu - berkomitmen memberikan pelayanan cepat, transparan, dan modern berbasis digital.">
    <meta property="og:description" content="Pelayanan terbaik lahir dari keikhlasan dan kebersamaan">
    <meta property="og:site_name" content="Senapelan">
    
    <!-- Gambar preview -->
    <meta property="og:image" content="https://senapelan.github.io/Home/data/foto/thumbnail.png">
    <meta property="og:image:secure_url" content="https://senapelan.github.io/Home/data/foto/thumbnail.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    
    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Senapelan Satu Pintu - berkomitmen memberikan pelayanan cepat, transparan, dan modern berbasis digital.">
    <meta name="twitter:description" content="Pelayanan terbaik lahir dari keikhlasan dan kebersamaan">
    <meta name="twitter:image" content="https://senapelan.github.io/Home/data/foto/thumbnail.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="/Home/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/Home/data/foto/icon-apple/iconapple.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/Home/data/foto/icon-apple/iconapple.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/Home/data/foto/icon-apple/iconapple.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/Home/data/foto/icon-apple/iconapple.png">
    
    <!-- Favicon untuk berbagai browser -->
    <link rel="icon" type="image/png" sizes="32x32" href="/Home/data/foto/icon-andro/iconandro.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/Home/data/foto/icon-andro/iconandro.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/Home/data/foto/icon-andro/iconandro.png">
    
    <!-- FAVICON -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Logo_lambang_kota_pekanbaru.png/960px-Logo_lambang_kota_pekanbaru.png">
    
    <style>
        /* =========================
           CSS ANDA TETAP SAMA SEPERTI DI ATAS
           ========================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary: #0066FF;
            --primary-light: #3399FF;
            --primary-dark: #0047CC;
            --secondary: #00D4AA;
            --dark: #0A0F2B;
            --light: #F5F9FF;
            --gradient: linear-gradient(135deg, #0066FF 0%, #00D4AA 100%);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow: 0 20px 40px rgba(0, 102, 255, 0.15);
            --shadow-hover: 0 30px 60px rgba(0, 102, 255, 0.25);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 24px;
        }

        body {
            color: #fff;
            overflow-x: hidden;
            background: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .video-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .video-bg video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(1px) brightness(0.7) contrast(1.1) saturate(1.2);
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(
                135deg,
                rgba(10, 15, 43, 0.9) 0%,
                rgba(0, 70, 204, 0.4) 50%,
                rgba(0, 212, 170, 0.2) 100%
            );
            z-index: -1;
        }

        .marquee {
            background: linear-gradient(90deg, transparent, rgba(0, 102, 255, 0.15), transparent);
            padding: 16px 0;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--glass-border);
            border-bottom: 1px solid var(--glass-border);
        }

        .marquee span {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 90s linear infinite;
            font-weight: 500;
            color: #B3E0FF;
            font-size: 1.1rem;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        header {
            text-align: center;
            padding: 60px 40px 30px;
            position: relative;
            margin-bottom: 20px;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
        }

        header h1 {
            font-size: 3rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
            letter-spacing: 1px;
            margin-bottom: 16px;
            text-shadow: 0 10px 30px rgba(0, 102, 255, 0.3);
            text-transform: uppercase;
        }

        header p {
            margin-top: 16px;
            font-size: 1.3rem;
            color: #E6F2FF;
            font-weight: 300;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            position: relative;
            display: inline-block;
            padding: 0 50px;
        }

        header p::before {
            content: "‚ùù";
            position: absolute;
            left: 10px;
            top: -10px;
            color: var(--secondary);
            font-size: 2rem;
            opacity: 0.7;
        }

        header p::after {
            content: "‚ùû";
            position: absolute;
            right: 10px;
            bottom: -10px;
            color: var(--secondary);
            font-size: 2rem;
            opacity: 0.7;
        }

        .container {
            max-width: 1400px;
            margin: auto;
            padding: 20px 20px 80px;
            flex: 1;
        }

        .card-utama {
            max-width: 1000px;
            margin: 0 auto 80px;
            text-align: center;
            position: relative;
            width: 90%;
        }

        .card-utama a {
            display: block;
            text-decoration: none;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 50px 40px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card-utama a:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-hover);
        }

        .card-utama .img-container {
            position: relative;
            display: inline-block;
            margin-bottom: 30px;
            width: 100%;
            max-width: 400px;
        }

        .card-utama img {
            width: 100%;
            height: auto;
            max-height: 220px;
            object-fit: contain;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 10px 20px rgba(0, 102, 255, 0.3));
            transition: var(--transition);
        }

        .card-utama h3 {
            font-size: 2.2rem;
            color: #fff;
            font-weight: 700;
            margin-top: 25px;
            position: relative;
            padding-top: 20px;
        }

        .card-utama h3::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 50px 40px;
            justify-items: center;
            align-items: start;
        }

        .card {
            text-align: center;
            width: 100%;
            max-width: 380px;
            position: relative;
        }

        .card a {
            display: block;
            text-decoration: none;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 35px 25px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: 100%;
        }

        .card a:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .card .img-container {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 20px;
        }

        .card img {
            width: 100%;
            max-height: 160px;
            object-fit: contain;
            filter: drop-shadow(0 8px 16px rgba(0, 102, 255, 0.2));
            transition: var(--transition);
        }

        .card a:hover img {
            transform: scale(1.08);
        }

        .card h3 {
            margin-top: 15px;
            font-size: 1.5rem;
            font-weight: 600;
            color: #fff;
        }

        .card a:hover h3 {
            color: var(--secondary);
        }

        .visit-counter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(4px);
            padding: 6px 16px;
            border-radius: 50px;
            margin-top: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1rem;
        }

        .visit-counter span:first-child {
            font-size: 1.2rem;
            color: var(--secondary);
        }

        .visit-count {
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 1.1rem;
        }

        .counter-update {
            animation: counterPulse 0.5s ease;
        }

        @keyframes counterPulse {
            0% { background: rgba(0, 212, 170, 0.2); }
            50% { background: rgba(0, 212, 170, 0.5); }
            100% { background: rgba(0, 212, 170, 0.2); }
        }

        .footer {
            background: rgba(10, 15, 43, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px 20px 30px;
            text-align: center;
            border-top: 1px solid rgba(0, 102, 255, 0.2);
            margin-top: auto;
        }

        .footer-logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .footer-logo-item {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-logo-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(0, 102, 255, 0.3));
            transition: var(--transition);
        }

        .copyright {
            color: #B3E0FF;
            font-size: 1rem;
            font-weight: 300;
            margin-bottom: 15px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #8CC8FF;
            text-decoration: none;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: #fff;
        }

        .footer-note {
            color: rgba(179, 224, 255, 0.6);
            font-size: 0.9rem;
            margin-top: 25px;
            font-style: italic;
        }

        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(10, 15, 43, 0.97) 0%, rgba(0, 71, 204, 0.95) 100%);
            color: white;
            padding: 18px 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            z-index: 9999;
            transform: translateY(100%);
            transition: transform 0.5s;
            border-top: 2px solid var(--secondary);
            backdrop-filter: blur(25px);
            border-top-left-radius: 25px;
            border-top-right-radius: 25px;
        }

        .install-banner.active {
            transform: translateY(0);
        }

        .install-content {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            justify-content: center;
        }

        .install-icon {
            width: 55px;
            height: 55px;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.4);
            border: 2.5px solid var(--secondary);
            background: white;
            padding: 6px;
            object-fit: contain;
        }

        .install-text h4 {
            font-size: 1.2rem;
            margin-bottom: 6px;
            background: linear-gradient(90deg, #fff, var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .install-buttons {
            display: flex;
            gap: 12px;
            width: 100%;
            justify-content: center;
        }

        .install-btn {
            padding: 11px 25px;
            border-radius: 50px;
            background: var(--gradient);
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }

        .close-banner {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #E6F2FF;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 50px;
        }

        @media (max-width: 1199px) and (min-width: 768px) {
            .grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 767px) {
            .grid { grid-template-columns: 1fr; }
            header h1 { font-size: 1.8rem; }
            header p { font-size: 1.1rem; }
            .card-utama { max-width: 350px; }
            .card-utama h3 { font-size: 1.5rem; }
            .card { max-width: 350px; }
        }

        .glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 102, 255, 0.2) 0%, transparent 70%);
            filter: blur(40px);
            z-index: -1;
            pointer-events: none;
        }

        .glow-1 { top: 20%; left: 10%; }
        .glow-2 { bottom: 30%; right: 10%; }
    </style>
</head>
<body>

<!-- BACKGROUND -->
<div class="video-bg">
    <video autoplay muted loop>
        <source src="data/video/home.mp4" type="video/mp4">
    </video>
</div>
<div class="overlay"></div>

<!-- EFEK GLOW -->
<div class="glow glow-1"></div>
<div class="glow glow-2"></div>

<!-- RUNNING TEXT -->
<div class="marquee">
    <span>Selamat Datang di Kecamatan Senapelan Pelayanan Satu Pintu. Kami berkomitmen menghadirkan pelayanan publik yang cepat, mudah, transparan, dan humanis. Dengan semangat melayani dari hati, aparatur dan masyarakat berkolaborasi menciptakan tata kelola yang bersih, tertib, dan profesional.</span>
</div>

<!-- HEADER -->
<header>
    <h1>SELAMAT DATANG DI PORTAL WEBSITE<br>SENAPELAN SATU PINTU</h1>
    <p>"Kami berkomitmen memberikan pelayanan cepat, transparan, dan modern berbasis digital."</p>
</header>

<!-- MENU -->
<div class="container">
    
    <!-- CARD UTAMA -->
    <div class="card card-utama" data-id="kecamatan-senapelan" data-url="https://kec-senapelan.pekanbaru.go.id/">
        <a href="#" onclick="return false;" class="card-link">
            <div class="img-container">
                <img src="data/foto/kecamatansenapelan.png">
            </div>
            <h3>Website Kecamatan Senapelan</h3>
            <div class="visit-counter">
                <span>üëÅÔ∏è</span>
                <span class="visit-count" id="count-kecamatan-senapelan">0</span>
                <span>Kunjungan</span>
            </div>
        </a>
    </div>
    
    <!-- GRID 6 KELURAHAN -->
    <div class="grid">
        <div class="card" data-id="kampung-bandar" data-url="https://senapelan.github.io/Home/kelurahankampungbandar.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/kampungbandar.png">
                </div>
                <h3>Website Kelurahan Kampung Bandar</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-kampung-bandar">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>

        <div class="card" data-id="kampung-baru" data-url="https://senapelan.github.io/Home/kelurahankampungbaru.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/kampungbaru.png">
                </div>
                <h3>Website Kelurahan Kampung Baru</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-kampung-baru">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>

        <div class="card" data-id="kampung-dalam" data-url="https://senapelan.github.io/Home/kelurahankampungdalam.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/kampungdalam.png">
                </div>
                <h3>Website Kelurahan Kampung Dalam</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-kampung-dalam">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>

        <div class="card" data-id="padang-bulan" data-url="https://senapelan.github.io/Home/kelurahanpadangbulan.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/padangbulan.png">
                </div>
                <h3>Website Kelurahan Padang Bulan</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-padang-bulan">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>
        
        <div class="card" data-id="padang-terubuk" data-url="https://senapelan.github.io/Home/kelurahanpadangterubuk.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/padangterubuk.png">
                </div>
                <h3>Website Kelurahan Padang Terubuk</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-padang-terubuk">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>

        <div class="card" data-id="sago" data-url="https://senapelan.github.io/Home/kelurahansago.html">
            <a href="#" onclick="return false;" class="card-link">
                <div class="img-container">
                    <img src="data/foto/sago.png">
                </div>
                <h3>Website Kelurahan Sago</h3>
                <div class="visit-counter">
                    <span>üëÅÔ∏è</span>
                    <span class="visit-count" id="count-sago">0</span>
                    <span>Kunjungan</span>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-logo-container">
            <div class="footer-logo-item">
                <img src="https://senapelan.github.io/Home/data/foto/LOGOPEMKOT.png" alt="Logo Pemkot Pekanbaru">
            </div>
            <div class="footer-logo-item">
                <img src="https://senapelan.github.io/Home/data/foto/icon-andro/iconandro.png" alt="Logo Senapelan Satu Pintu">
            </div>
        </div>
        
        <div class="copyright">
            ¬© 2026 Senapelan Satu Pintu ‚Ä¢ Kecamatan Senapelan, Kota Pekanbaru
        </div>
        
        <div class="footer-links">
            <a href="https://kec-senapelan.pekanbaru.go.id/">Website Resmi</a>
            <a href="mailto:kecamatan.senapelan@gmail.com">Kontak Email</a>
            <a href="tel:+6281365256665">Telepon</a>
            <a href="https://www.google.com/maps/place/Kantor+Camat+Senapelan">Lokasi</a>
        </div>
        
        <div class="footer-note">
            Inovasi pelayanan publik berbasis digital untuk kesejahteraan masyarakat.
            Semua hak dilindungi undang-undang.
        </div>
    </div>
</footer>

<!-- INSTALL BANNER -->
<div class="install-banner" id="installBanner">
    <div class="install-content">
        <img src="data/foto/icon-andro/icon512.png" alt="App Icon" class="install-icon">
        <div class="install-text">
            <h4>Pasang Aplikasi Senapelan Satu Pintu</h4>
            <p>Akses lebih mudah dengan memasang aplikasi di perangkat Anda</p>
        </div>
    </div>
    <div class="install-buttons">
        <button class="install-btn" id="installBtn">Pasang Sekarang</button>
        <button class="close-banner" id="closeBanner">Nanti Saja</button>
    </div>
</div>

<audio id="bgMusic" loop>
    <source src="data/sound/home.mp3" type="audio/mpeg">
</audio>

<script>
// ============================================
// SENAPELAN COUNTER SYSTEM - VERSI FINAL DENGAN LOG
// ============================================

// üî¥ GANTI URL INI DENGAN URL DEPLOYMENT APPS SCRIPT ANDA!
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw-vuk-JmDHnsyiWXXy8kb4M_kkOObjfLeCfmkWRFTeeYScUuL_aR9kd8ju5M583WeASg/exec';

// DATA COUNTER
let visitCounters = {
    'kecamatan-senapelan': 0,
    'kampung-bandar': 0,
    'kampung-baru': 0,
    'kampung-dalam': 0,
    'padang-bulan': 0,
    'padang-terubuk': 0,
    'sago': 0
};

// ============================================
// MUSIK BACKGROUND
// ============================================
document.addEventListener("click", function() {
    const music = document.getElementById("bgMusic");
    if (music) music.play();
}, { once: true });

// ============================================
// PWA INSTALL
// ============================================
let deferredPrompt;
const installBanner = document.getElementById('installBanner');
const installBtn = document.getElementById('installBtn');
const closeBanner = document.getElementById('closeBanner');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    setTimeout(() => installBanner.classList.add('active'), 3000);
});

installBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        localStorage.setItem('senapelanAppInstalled', 'true');
        deferredPrompt = null;
    }
});

closeBanner.addEventListener('click', () => {
    installBanner.classList.remove('active');
    localStorage.setItem('senapelanBannerDismissed', 'true');
});

// ============================================
// LOAD DATA DARI SPREADSHEET (JSONP)
// ============================================
function loadCountersFromSheet() {
    console.log('üì° Mengambil data kunjungan...');
    
    loadFromLocalStorage();
    
    const callbackName = 'jsonp_callback_' + Date.now();
    
    window[callbackName] = function(response) {
        if (response && response.success && response.data) {
            visitCounters = { ...visitCounters, ...response.data };
            saveToLocalStorage();
            updateAllCounters();
            console.log('‚úÖ Data berhasil dimuat:', visitCounters);
        }
        
        delete window[callbackName];
        if (document.body.contains(script)) document.body.removeChild(script);
    };
    
    const script = document.createElement('script');
    script.src = `${APPS_SCRIPT_URL}?action=get&callback=${callbackName}&t=${Date.now()}`;
    document.body.appendChild(script);
    
    setTimeout(() => {
        if (window[callbackName]) {
            delete window[callbackName];
            if (document.body.contains(script)) document.body.removeChild(script);
        }
    }, 10000);
}

// ============================================
// UPDATE COUNTER + LOG
// ============================================
function updateCounterToSheet(id, url) {
    // Update lokal
    visitCounters[id] = (visitCounters[id] || 0) + 1;
    updateSingleCounter(id);
    saveToLocalStorage();
    
    console.log(`üì§ Update ${id}: ${visitCounters[id]}`);
    
    // Kirim ke spreadsheet dengan data lengkap untuk LOG
    const callbackName = 'update_callback_' + Date.now();
    
    window[callbackName] = function(response) {
        if (response && response.success) {
            if (response.data && response.data.current) {
                visitCounters[id] = response.data.current;
                updateSingleCounter(id);
                saveToLocalStorage();
                console.log(`‚úÖ ${id}: ${response.data.current} kunjungan`);
            }
        }
        
        delete window[callbackName];
        if (document.body.contains(script)) document.body.removeChild(script);
    };
    
    const script = document.createElement('script');
    const params = new URLSearchParams({
        action: 'update',
        id: id,
        url: url,
        userAgent: navigator.userAgent,
        ip: 'unknown', // IP tidak bisa diambil JS
        callback: callbackName,
        t: Date.now()
    }).toString();
    
    script.src = `${APPS_SCRIPT_URL}?${params}`;
    document.body.appendChild(script);
}

// ============================================
// LOCAL STORAGE
// ============================================
function saveToLocalStorage() {
    localStorage.setItem('senapelan_visitors', JSON.stringify(visitCounters));
}

function loadFromLocalStorage() {
    const saved = localStorage.getItem('senapelan_visitors');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            visitCounters = { ...visitCounters, ...data };
            updateAllCounters();
        } catch (e) {}
    }
}

// ============================================
// UPDATE TAMPILAN
// ============================================
function updateAllCounters() {
    Object.keys(visitCounters).forEach(key => {
        const el = document.getElementById(`count-${key}`);
        if (el) el.textContent = visitCounters[key]?.toLocaleString() || '0';
    });
}

function updateSingleCounter(id) {
    const el = document.getElementById(`count-${id}`);
    if (el) {
        el.textContent = visitCounters[id]?.toLocaleString() || '0';
        el.classList.add('counter-update');
        setTimeout(() => el.classList.remove('counter-update'), 500);
    }
}

// ============================================
// HANDLE CLICK CARD
// ============================================
function handleCardClick(e, id, url) {
    e.preventDefault();
    
    const card = e.currentTarget.closest('.card');
    if (card) {
        card.style.transform = 'scale(0.98)';
        setTimeout(() => card.style.transform = '', 200);
    }
    
    updateCounterToSheet(id, url);
    
    setTimeout(() => {
        window.location.href = url;
    }, 300);
}

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ SENAPELAN COUNTER SYSTEM - WITH LOG');
    
    // Load data
    loadFromLocalStorage();
    setTimeout(loadCountersFromSheet, 500);
    
    // Attach event listeners
    document.querySelectorAll('.card').forEach(card => {
        const link = card.querySelector('.card-link');
        const id = card.dataset.id;
        const url = card.dataset.url;
        
        if (link && id && url) {
            link.removeEventListener('click', handleCardClick);
            link.addEventListener('click', function(e) {
                handleCardClick(e, id, url);
            });
        }
    });
    
    // Auto refresh setiap 30 detik
    setInterval(() => {
        if (!document.hidden) loadCountersFromSheet();
    }, 30000);
});

// ============================================
// DEBUG TOOLS
// ============================================
window.Senapelan = {
    data: visitCounters,
    refresh: loadCountersFromSheet,
    reset: function() {
        visitCounters = {
            'kecamatan-senapelan': 0,
            'kampung-bandar': 0,
            'kampung-baru': 0,
            'kampung-dalam': 0,
            'padang-bulan': 0,
            'padang-terubuk': 0,
            'sago': 0
        };
        saveToLocalStorage();
        updateAllCounters();
        console.log('üîÑ Counter reset (local)');
    }
};
</script>
    
</body>
</html>
